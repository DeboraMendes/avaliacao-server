-- EXCLUIR A DATABASE SE EXISTIR
--DROP DATABASE   IF     EXISTS AVALIACAO;

-- CRIAR A DATABASE
--CREATE DATABASE IF NOT EXISTS AVALIACAO;

-- CONECTAR A DATABASE
--USE AVALIACAO;

-- CRIAR TABELAS
CREATE TABLE estado
(
	ID INTEGER  AUTO_INCREMENT, PRIMARY KEY (ID),
	CODIGO_IBGE INTEGER NOT NULL,
	NOME VARCHAR(800) NOT NULL,
	SIGLA VARCHAR(2) NOT NULL
);

CREATE TABLE cidade
(
	ID INTEGER  AUTO_INCREMENT, PRIMARY KEY (ID),
	NOME VARCHAR(800) NOT NULL,
	ID_ESTADO INTEGER NOT NULL
);

CREATE TABLE endereco
(
	ID INTEGER AUTO_INCREMENT, PRIMARY KEY (ID),
	RUA VARCHAR(800) NOT NULL,
	NUMERO INTEGER,
	BAIRRO VARCHAR(800) NOT NULL,
	CEP VARCHAR(9) NOT NULL,
	COMPLEMENTO VARCHAR(800) NOT NULL,
    ID_CIDADE INTEGER
);

CREATE TABLE empresa
(
	ID INTEGER  AUTO_INCREMENT, PRIMARY KEY (ID),
	NOME VARCHAR(800) NOT NULL,
	EMAIL VARCHAR(800),
    TELEFONE VARCHAR(11),
	ID_ENDERECO INTEGER
);

CREATE TABLE tipo_onibus
(
	ID INTEGER  AUTO_INCREMENT, PRIMARY KEY (ID),
	DESCRICAO VARCHAR(800) NOT NULL
);

CREATE TABLE tarifa
(
	ID INTEGER  AUTO_INCREMENT, PRIMARY KEY (ID),
	PARTIDA TIME NOT NULL,
	VALOR DECIMAL NOT NULL,
    ID_TIPO_ONIBUS INTEGER NOT NULL,
	TEMPO_VIAJEM TIME
);

CREATE TABLE passagem
(
	ID INTEGER  AUTO_INCREMENT, PRIMARY KEY (ID),
	ID_EMPRESA INTEGER NOT NULL,
	DIA_DA_SEMANA TIMESTAMP NOT NULL,
    ID_CIDADE_ORIGEM INTEGER NOT NULL,
	ID_CIDADE_DESTINO INTEGER NOT NULL
);

CREATE TABLE horarios_tarifas
(
	ID INTEGER  AUTO_INCREMENT, PRIMARY KEY (ID),
	ID_PASSAGEM INTEGER NOT NULL,
	ID_TARIFA INTEGER NOT NULL
);

ALTER TABLE cidade ADD CONSTRAINT FK_ID_ESTADO_CIDADE FOREIGN KEY (ID_ESTADO) REFERENCES estado (ID);
ALTER TABLE endereco ADD CONSTRAINT FK_ID_CIDADE_ENDERECO FOREIGN KEY (ID_CIDADE) REFERENCES cidade (ID);
ALTER TABLE empresa ADD CONSTRAINT FK_ID_EMPRESA_ENDERECO FOREIGN KEY (ID_ENDERECO) REFERENCES endereco (ID);
ALTER TABLE tarifa ADD CONSTRAINT FK_ID_TIPO_ONIBUS_TARIFA FOREIGN KEY (ID_TIPO_ONIBUS) REFERENCES tipo_onibus (ID);
ALTER TABLE passagem ADD CONSTRAINT FK_ID_EMPRESA_PASSAGEM FOREIGN KEY (ID_EMPRESA) REFERENCES empresa (ID);
ALTER TABLE passagem ADD CONSTRAINT FK_ID_CIDADE_ORIGEM_PASSAGEM FOREIGN KEY (ID_CIDADE_ORIGEM) REFERENCES cidade (ID);
ALTER TABLE passagem ADD CONSTRAINT FK_ID_CIDADE_DESTINO_PASSAGEM FOREIGN KEY (ID_CIDADE_DESTINO) REFERENCES cidade (ID);
ALTER TABLE horarios_tarifas ADD CONSTRAINT FK_ID_PASSAGEM_HORARIOS_TARIFAS FOREIGN KEY (ID_PASSAGEM) REFERENCES passagem (ID);
ALTER TABLE horarios_tarifas ADD CONSTRAINT FK_ID_TARIFA__HORARIOS_TARIFAS FOREIGN KEY (ID_TARIFA) REFERENCES tarifa (ID);

